extends ../../layout/default.pug
include ../../mixins/alert.pug

block main
    if role.permissions.includes('products_view') 
        +alert-success(5000)
        
        .container-fluid
            .d-flex.justify-content-between.align-items-center.mb-4
                h1.mb-0 Product Detail
                .btn-group
                    if role.permissions.includes('products_edit')
                        a(href=`/${prefixAdmin}/products/edit/${product._id}` class="btn btn-primary")
                            i.fas.fa-edit
                            | #{" "} Edit Product
                    a(href=`/${prefixAdmin}/products` class="btn btn-secondary")
                        i.fas.fa-arrow-left
                        | #{" "} Back to List

            .row
                .col-md-5
                    .card
                        .card-body.text-center
                            if product.thumbnail
                                img(src=product.thumbnail alt=product.title class="img-fluid rounded mb-3" style="max-height: 400px; object-fit: contain;")
                            else
                                .bg-light.d-flex.align-items-center.justify-content-center(style="height: 400px;")
                                    span.text-muted No Image Available
                            
                            if product.images && product.images.length > 0
                                .image-gallery.mt-3
                                    strong Additional Images:
                                    .d-flex.flex-wrap.gap-2.mt-2.justify-content-center
                                        each image in product.images
                                            img(src=image alt="Product Image" class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover;")

                .col-md-7
                    .card
                        .card-header
                            h3.mb-0 #{product.title}
                        .card-body
                            .row.mb-3
                                .col-md-6
                                    p.mb-2
                                        strong Category: 
                                        if product.product_category_id
                                            span.badge.bg-info #{product.product_category_id.title || 'N/A'}
                                        else
                                            span.text-muted None
                                    
                                    p.mb-2
                                        strong Brand: 
                                        | #{product.brand || 'N/A'}
                                    
                                    p.mb-2
                                        strong SKU: 
                                        | #{product.sku || 'N/A'}
                                
                                .col-md-6
                                    p.mb-2
                                        strong Status: 
                                        if product.status === 'active'
                                            span.badge.bg-success Active
                                        else
                                            span.badge.bg-secondary Inactive
                                    
                                    p.mb-2
                                        strong Featured: 
                                        if product.feature === '1'
                                            span.badge.bg-warning Yes
                                        else
                                            span.badge.bg-light.text-dark No
                                    
                                    p.mb-2
                                        strong Position: 
                                        | #{product.position || 'N/A'}

                            hr

                            .row.mb-3
                                .col-md-6
                                    h5 Pricing
                                    p.mb-2
                                        strong Original Price: 
                                        span.fs-5 $#{product.price.toFixed(2)}
                                    
                                    if product.discountPercentage && product.discountPercentage > 0
                                        p.mb-2
                                            strong Discount: 
                                            span.badge.bg-success #{product.discountPercentage}% OFF
                                        p.mb-2
                                            strong Sale Price: 
                                            span.fs-5.text-success $#{product.priceNew}
                                
                                .col-md-6
                                    h5 Inventory
                                    p.mb-2
                                        strong Stock: 
                                        if product.stock > 0
                                            span.badge.bg-success #{product.stock} units
                                        else
                                            span.badge.bg-danger Out of Stock
                                    
                                    if product.rating
                                        p.mb-2
                                            strong Rating: 
                                            span.text-warning
                                                i.fas.fa-star
                                                | #{" "} #{product.rating} / 5

                            hr

                            .mb-3
                                h5 Description
                                if product.description
                                    div !{product.description}
                                else
                                    p.text-muted No description available

                            if product.tags && product.tags.length > 0
                                hr
                                .mb-3
                                    h5 Tags
                                    each tag in product.tags
                                        span.badge.bg-secondary.me-1 #{tag}

                            if product.dimensions || product.weight
                                hr
                                .mb-3
                                    h5 Dimensions & Weight
                                    if product.dimensions
                                        p.mb-2
                                            strong Dimensions: 
                                            | W: #{product.dimensions.width || 'N/A'}cm × H: #{product.dimensions.height || 'N/A'}cm × D: #{product.dimensions.depth || 'N/A'}cm
                                    
                                    if product.weight
                                        p.mb-2
                                            strong Weight: 
                                            | #{product.weight} kg

                            if product.warrantyInformation || product.shippingInformation || product.availabilityStatus
                                hr
                                .mb-3
                                    h5 Additional Information
                                    if product.warrantyInformation
                                        p.mb-2
                                            strong Warranty: 
                                            | #{product.warrantyInformation}
                                    
                                    if product.shippingInformation
                                        p.mb-2
                                            strong Shipping: 
                                            | #{product.shippingInformation}
                                    
                                    if product.availabilityStatus
                                        p.mb-2
                                            strong Availability: 
                                            span.badge.bg-info #{product.availabilityStatus}

                            hr
                            .mb-3
                                h5 Metadata
                                p.mb-1
                                    small.text-muted
                                        strong Created: 
                                        | #{product.createdAt ? new Date(product.createdAt).toLocaleString() : 'N/A'}
                                p.mb-1
                                    small.text-muted
                                        strong Last Updated: 
                                        | #{product.updatedAt ? new Date(product.updatedAt).toLocaleString() : 'N/A'}
                                
                                if product.createdBy && product.createdBy.accountId
                                    p.mb-1
                                        small.text-muted
                                            strong Created By: 
                                            | #{product.createdBy.accountId.fullName || 'N/A'}

            if product.reviews && product.reviews.length > 0
                hr.my-4
                .row
                    .col-12
                        .card
                            .card-header
                                h4.mb-0
                                    i.fas.fa-comments
                                    | #{" "} Customer Reviews (#{product.reviews.length})
                            .card-body
                                each review in product.reviews
                                    .card.mb-3
                                        .card-body
                                            .d-flex.justify-content-between.align-items-start
                                                div
                                                    h5.card-title.mb-1 #{review.reviewerName}
                                                    h6.card-subtitle.text-muted.mb-2 #{review.reviewerEmail}
                                                div
                                                    span.badge.bg-warning.text-dark
                                                        i.fas.fa-star
                                                        | #{" "} #{review.rating}/5
                                            p.card-text.mt-2 #{review.comment}
                                            small.text-muted
                                                i.far.fa-calendar
                                                | #{" "} #{review.date ? new Date(review.date).toLocaleString() : 'N/A'}
